/*! sdk-js - v2.0.0 - 2015-11-03
* Copyright (c) 2015 Schibsted Products and Technology; */
var SPiD=function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){function d(a){a.SPiD=a.SPiD||this,a.SPiD.Talk=c(10)}function e(a,b){m.init(a),m.options().noGlobalExport||d(window),n=!0,b&&b()}function f(a){a=a||function(){};var b=this,c=function(b,c){r.session(o,c),o=c,a(b,c)},d=function(a,b){!a&&b.result&&s.set(b,b.expiresIn),c(a,b)},e=function(a,c){return a&&"LoginException"===a.type?(q.fire("SPiD.loginException"),u.request(b.coreEndpoint(),null,{autologin:1},d)):(a&&q.fire("SPiD.error",a),void d(a,c))},f=s.get();return f?(o=f,c(null,f)):void u.request(this.sessionEndpoint(),null,{autologin:1},e)}function g(a,b){if(b=b||function(){},t.enabled()){var c=t.get("prd_{id}".replace("{id}",a));if(c&&c.refreshed+m.options().refresh_timeout>p.now())return b(null,c)}var d=function(c,d){t.enabled()&&!c&&d.result&&(d.refreshed=p.now(),t.set("prd_{id}".replace("{id}",a),d)),!c&&d.result&&q.fire("SPiD.hasProduct",{productId:a,result:d.result}),b(c,d)};u.request(this.server(),"ajax/hasproduct.js",{product_id:a},d)}function h(a,b){if(b=b||function(){},t.enabled()){var c=t.get("sub_{id}".replace("{id}",a));if(c&&c.refreshed+m.options().refresh_timeout>p.now())return b(null,c)}var d=function(c,d){t.enabled()&&!c&&d.result&&(d.refreshed=p.now(),t.set("sub_{id}".replace("{id}",a),d)),!c&&d.result&&q.fire("SPiD.hasSubscription",{subscriptionId:a,result:d.result}),b(c,d)};u.request(this.server(),"ajax/hassubscription.js",{product_id:a},d)}function i(a,b){b=b||function(){},u.request(this.server(),"ajax/traits.js",{t:a},b)}function j(a){var b=function(b,c){c.result&&s.clear(),!b&&c.result&&q.fire("SPiD.logout",c),a&&a(b,c)};u.request(this.server(),"ajax/logout.js",{},b)}function k(a){var b=this,c=function(){s.clear(),b.hasSession(a)};u.request(this.server(),"ajax/acceptAgreement.js",{},c)}var l="2.0.0",m=c(1),n=!1,o={},p=c(2),q=c(4),r=c(5),s=c(6),t=c(9),u=c(10);window.setTimeout(function(){"function"!=typeof window.asyncSPiD||window.asyncSPiD.hasRun||(window.asyncSPiD(),window.asyncSPiD.hasRun=!0)},0),a.exports={version:function(){return l},initiated:function(){return n},server:function(){return(m.options().https?"https":"http")+"://"+m.options().server+"/"},sessionEndpoint:function(){return(m.options().https?"https":"http")+"://"+(m.options().useSessionCluster?"session."+m.options().server+"/rpc/hasSession.js":m.options().server+"/ajax/hasSession.js")},coreEndpoint:function(){return(m.options().https?"https":"http")+"://"+m.options().server+"/ajax/hasSession.js"},acceptAgreement:k,event:q,sessionCache:s,init:e,hasSession:f,hasProduct:g,hasSubscription:h,setTraits:i,logout:j}},function(a,b,c){var d={},e={server:null,client_id:null,cache:!1,logging:!1,useSessionCluster:!0,https:!0,storage:"localstorage",timeout:15e3,refresh_timeout:9e5,varnish_expiration:null},f=c(2);a.exports={options:function(){return d},init:function(a){if(d=f.copy(a,e),!d.server)throw new TypeError("[SPiD] server parameter is required");if(!d.client_id)throw new TypeError("[SPiD] client_id parameter is required");d.refresh_timeout<=6e4&&(d.refresh_timeout=6e4)},server:function(){return(d.https?"https":"http")+"://"+d.server+"/"}}},function(a,b,c){function d(a,b){for(var c in b)void 0===a[c]&&(a[c]=b[c]);return a}function e(){return(new Date).getTime()}function f(a,b,c){var d=[];for(var e in c)c[e]&&d.push(e+"="+c[e]);var f=a+(b||"")+"?"+d.join("&");return g.info("SPiD.Util.buildUri() built {u}".replace("{u}",f)),f}var g=c(3);a.exports={copy:d,now:e,buildUri:f}},function(a,b,c){function d(){var a=c(1);return!(!window.console||!a.options().logging&&-1===window.location.toString().indexOf("spid_debug=1"))}function e(a,b){d()&&window.console[b]("[SPiD] "+a)}function f(a){e(a,"info")}function g(a){e(a,"error")}a.exports={enabled:d,info:f,error:g}},function(a,b,c){function d(a,b){h.info("SPiD.Event.subscribe({n})".replace("{n}",a)),g[a]||(g[a]=[]),g[a].push(b)}function e(a,b){h.info("SPiD.Event.unsubscribe({n})".replace("{n}",a));for(var c=g[a]||[],d=0,e=c.length;d!==e;d++)c[d]===b&&(c[d]=null)}function f(){var a=Array.prototype.slice.call(arguments),b=a.shift();h.info("SPiD.Event.fire({n})".replace("{n}",b));for(var c=g[b]||[],d=0,e=c.length;d!==e;d++)c[d]&&c[d].apply(this,a)}var g={},h=c(3);a.exports={subscribe:d,unsubscribe:e,fire:f}},function(a,b,c){function d(a,b){b.visitor&&e.fire("SPiD.visitor",b.visitor),b.userId&&a.userId!==b.userId&&e.fire("SPiD.login",b),a.userId&&!b.userId&&e.fire("SPiD.logout",b),a.userId&&b.userId&&a.userId!==b.userId&&e.fire("SPiD.userChange",b),(b.userId||a.userId)&&e.fire("SPiD.sessionChange",b),b.userId||a.userId||e.fire("SPiD.notLoggedin",b),b.userId&&!f&&(f=!0,e.fire("SPiD.sessionInit",b)),b.userStatus!==g&&(g=b.userStatus,e.fire("SPiD.statusChange",b))}var e=c(4),f=!1,g="unknown";a.exports={session:d}},function(a,b,c){function d(){var a=c(7),b={localstorage:c(8),cookie:{get:a.get,set:function(b,c){a.set(c)},clear:a.clear},standard:{get:g,set:g,clear:g}};return b[e.options().storage||"standard"]}var e=c(1),f="Session",g=function(){};a.exports={get:function(){return d().get(f)},set:function(a,b){return d().set(f,a,b)},clear:function(){return d().clear(f)}}},function(a,b,c){function d(a){return JSON.parse(window.unescape(a))}function e(a){return window.escape(JSON.stringify(a))}function f(){var a=n.options();return"spid_js_"+a.client_id}function g(a,b,c,d){var e=new Date;e.setTime(e.getTime()+1e3*c);var f="{n}={v}; expires={e}; path=/; domain=.{d}".replace("{n}",a).replace("{v}",b).replace("{e}",e.toUTCString()).replace("{d}",d);document.cookie=f}function h(a){var b=n.options();if(!a)return!1;if(k=a.baseDomain,g(f(),e(a),a.expiresIn,k),m.info("SPiD.Cookie.set({n})".replace("{n}",f())),a.sp_id){var c=b.varnish_expiration||a.expiresIn;g(l,a.sp_id,c,k),m.info("SPiD.Cookie.set({n})".replace("{n}",l))}}function i(){m.info("SPiD.Cookie.get()");var a="; "+document.cookie,b=a.split("; "+f()+"="),c=2===b.length?b.pop().split(";").shift():null;if(c){var e=d(c);return e.expiresIn=parseInt(e.expiresIn,10),e.clientTime=parseInt(e.clientTime,10),k=e.baseDomain,e}return null}function j(){m.info("SPiD.Cookie.clear()"),g(f(),"",0,k),g(l,"",0,k)}var k,l="SP_ID",m=c(3),n=c(1);a.exports={decode:d,encode:e,set:h,get:i,clear:j,name:f}},function(a,b,c){function d(a){return JSON.parse(a)}function e(a){return JSON.stringify(a)}function f(a){return l+a}function g(a,b,c){try{if(c){var d=new Date;d.setTime(d.getTime()+1e3*c),b._expires=d}window.localStorage.setItem(f(a),e(b))}catch(g){k.info(g)}}function h(a){try{window.localStorage.clear(f(a))}catch(b){k.info(b)}}function i(a){return a&&a._expires?new Date(a._expires).getTime()<(new Date).getTime():!1}function j(a){try{var b=d(window.localStorage.getItem(f(a)));return i(b)?(h(a),null):b}catch(c){k.info(c)}return null}var k=c(3),l="SPiD_",m=!0;a.exports={set:g,get:j,clear:h,enabled:m}},function(a,b,c){function d(a){return JSON.parse(window.unescape(a))}function e(a){return window.escape(JSON.stringify(a))}function f(){return!!k.options().cache}function g(a,b){f()&&(j[a]=e(b))}function h(a){return f()?j[a]?d(j[a]):null:void 0}function i(a){f()&&j[a]&&(j[a]=null)}var j={},k=c(1);a.exports={decode:d,encode:e,enabled:f,set:g,get:h,clear:i}},function(a,b,c){function d(){return"f"+(Math.random()*(1<<30)).toString(16).replace(".","")}function e(a){var b=d();return q[b]=function(b,c){a(b,c)},b}function f(a,b){r.push({id:a,url:b})}function g(){return null!==s}function h(){p&&(p.parentNode.removeChild(p),p=null)}function i(a,b){if(window.clearTimeout(s),s=null,h(),m(),q[a]){var c=q[a];q[a]=null;var d=b.error?b.error:null,e=b.response?b.response:b;c(d,e)}}function j(a,b){u.error(a),i(b,{error:{type:"communication",code:503,description:a},response:{}})}function k(a){p=document.createElement("SCRIPT"),p.src=a.url,p.type="text/javascript",p.onerror=function(){j("Browser triggered error",a.id)};var b=document.getElementsByTagName("HEAD")[0];b.appendChild(p)}function l(a){var b=c(1).options();k(a),s=window.setTimeout(function(){j("Timeout reached",a.id)},b.timeout)}function m(){if(!g()&&r.length>0){var a=r.shift();l(a)}}function n(a,b,c,d){var g=e(d);c=c||{},c.callback=g,c.redirect_uri=t,c.client_id=w.options().client_id;var h=v.buildUri(a,b,c);u.info("Request: "+h),f(g,h),m()}function o(a,b){u.info("Response received"),i(a,b)}var p,q={},r=[],s=null,t=encodeURIComponent(window.location.toString()),u=c(3),v=c(2),w=c(1);a.exports={request:n,response:o}}]);